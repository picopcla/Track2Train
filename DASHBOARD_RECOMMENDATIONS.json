{
  "title": "Recommandations d'√©l√©ments √† ajouter au Dashboard",
  "priority": "Sant√© cardiaque et progression durable pour homme 52 ans",

  "critical_alerts": {
    "description": "Alertes √† afficher en haut de page si d√©passement de seuils",
    "elements": [
      {
        "name": "Alerte D√©rive Cardio",
        "condition": "deriv_cardio > 1.25",
        "message": "üî¥ ALERTE : D√©rive cardio √©lev√©e ({{ deriv_cardio }}). R√©duire l'intensit√© des prochaines sorties.",
        "color": "red",
        "action": "Conseiller de courir en Zone 2 (FC < 120 bpm)"
      },
      {
        "name": "Alerte FC Max fr√©quente",
        "condition": "fc_max > 160 bpm sur 2 courses cons√©cutives",
        "message": "‚ö†Ô∏è ATTENTION : FC max √©lev√©e ({{ fc_max }} bpm). Partir plus progressivement.",
        "color": "orange",
        "action": "Recommander d√©part √† 110 bpm et mont√©e progressive"
      },
      {
        "name": "Temps excessif en Zone 4-5",
        "condition": "time_in_zone_4_5 > 40%",
        "message": "üü° INFO : Tu passes {{ time_in_zone_4_5 }}% du temps en Zone 4-5. Objectif : < 20%",
        "color": "yellow",
        "action": "Encourager sorties en Zone 2"
      }
    ]
  },

  "new_indicators": {
    "description": "Nouveaux indicateurs √† calculer et afficher",
    "items": [
      {
        "name": "Score de D√©rive Cardio",
        "formula": "deriv_cardio = (FC_dernier_tiers / FC_premier_tiers)",
        "thresholds": {
          "excellent": "< 1.05",
          "bon": "1.05 - 1.15",
          "attention": "1.15 - 1.25",
          "alerte": "> 1.25"
        },
        "display": "Grosse jauge color√©e avec emoji (üü¢üü°üü†üî¥)",
        "explanation": "Plus important que k_moy pour d√©tecter les sorties trop intenses",
        "priority": "CRITIQUE"
      },
      {
        "name": "Variabilit√© FC intra-course",
        "formula": "((FC_max - FC_min) / FC_min) * 100",
        "thresholds": {
          "excellent": "< 15%",
          "moyen": "15% - 25%",
          "mauvais": "> 25%"
        },
        "display": "Petit graphique sparkline montrant l'√©volution de la FC",
        "explanation": "D√©tecte les d√©parts trop brutaux (ex: +31% sur derni√®re course)",
        "priority": "HAUTE"
      },
      {
        "name": "Temps pass√© par Zone FC",
        "formula": "Pourcentage du temps dans chaque zone (Z1 √† Z5)",
        "zones": {
          "Z1": "50-60% FC max (84-101 bpm) - R√©cup√©ration",
          "Z2": "60-70% FC max (101-117 bpm) - Endurance üéØ",
          "Z3": "70-80% FC max (117-134 bpm) - Tempo",
          "Z4": "80-90% FC max (134-151 bpm) - Seuil",
          "Z5": "90-100% FC max (151-168 bpm) - Max ‚ö†Ô∏è"
        },
        "target": "Z2 ‚â• 60%, Z3 20-30%, Z4+Z5 < 10%",
        "display": "Graphique en barres horizontales empil√©es",
        "priority": "HAUTE"
      },
      {
        "name": "Allure en Zone 2 (Decoupling)",
        "formula": "Allure moyenne quand FC est dans Zone 2 (101-117 bpm)",
        "display": "Graphique ligne sur les 20 derni√®res courses",
        "explanation": "Si l'allure en Z2 s'am√©liore = PROGRESSION a√©robie",
        "target": "Voir l'allure en Z2 diminuer (courir plus vite √† m√™me FC)",
        "priority": "MOYENNE"
      },
      {
        "name": "FC au repos (FC repos)",
        "formula": "FC mesur√©e au r√©veil avant de se lever",
        "source": "Donn√©es Strava (si disponibles) ou saisie manuelle",
        "thresholds": {
          "excellent": "< 50 bpm",
          "bon": "50-60 bpm",
          "attention": "> 60 bpm"
        },
        "display": "Graphique ligne sur 30 jours",
        "explanation": "Une FC repos qui augmente = fatigue/surentra√Ænement",
        "priority": "MOYENNE"
      },
      {
        "name": "Ratio FC/Allure (Efficacit√© instantan√©e)",
        "formula": "FC_moyenne / Allure_moy (bpm par min/km)",
        "explanation": "Plus le ratio est bas, plus tu es efficient",
        "display": "Graphique sur 20 derni√®res courses",
        "target": "Ratio qui diminue = am√©lioration de l'efficacit√©",
        "priority": "BASSE"
      }
    ]
  },

  "dashboard_sections": {
    "description": "Organisation recommand√©e du dashboard",
    "sections": [
      {
        "section": "1. ALERTES (en haut)",
        "content": [
          "Alerte D√©rive Cardio si > 1.25",
          "Alerte FC Max si > 160 bpm sur 2 courses",
          "Alerte temps en Z4-Z5 si > 40%"
        ],
        "style": "Bandeau color√© (rouge/orange/jaune) collapsible"
      },
      {
        "section": "2. COACHING MESSAGE",
        "content": [
          "Message personnalis√© chaleureux (voir COACHING_MESSAGE_UI.txt)",
          "Conseil du jour bas√© sur la derni√®re course",
          "Encouragement"
        ],
        "style": "Card avec emoji, fond clair, texte lisible"
      },
      {
        "section": "3. INDICATEURS CL√âS (cards)",
        "content": [
          "Score D√©rive Cardio (grosse jauge)",
          "k_moy avec sparkline (d√©j√† pr√©sent ‚úÖ)",
          "Temps par Zone FC (graphique barres)",
          "Variabilit√© FC (pourcentage)"
        ],
        "style": "Grid 2x2, cards color√©es selon seuils"
      },
      {
        "section": "4. GRAPHIQUES D√âTAILL√âS",
        "content": [
          "Graphiques synchronis√©s (FC, Allure, √âl√©vation) ‚úÖ D√âJ√Ä PR√âSENT",
          "NOUVEAU : Overlay zones FC sur graphique FC (couleurs de fond)",
          "NOUVEAU : Annotation \"D√©rive cardio\" sur graphique FC"
        ],
        "style": "Graphiques ApexCharts avec zones color√©es"
      },
      {
        "section": "5. √âVOLUTIONS (tendances)",
        "content": [
          "Graphique ligne : D√©rive cardio sur 20 courses",
          "Graphique ligne : k_moy sur 20 courses",
          "Graphique ligne : Allure en Z2 sur 20 courses",
          "Graphique ligne : FC repos sur 30 jours (si disponible)"
        ],
        "style": "4 petits graphiques ApexCharts en grid"
      },
      {
        "section": "6. PR√âDICTIONS",
        "content": [
          "Objectif 10 km : Date estim√©e + temps pr√©dit",
          "Objectif Semi : Date estim√©e + temps pr√©dit",
          "Conditions : Respect des zones FC"
        ],
        "style": "Card avec ic√¥nes üéØ et timeline"
      },
      {
        "section": "7. HISTORIQUE (d√©j√† pr√©sent)",
        "content": [
          "Tableau des derni√®res courses ‚úÖ",
          "Graphiques k et d√©rive cardio ‚úÖ"
        ]
      }
    ]
  },

  "modifications_graphiques_existants": {
    "description": "Am√©liorations des graphiques ApexCharts d√©j√† pr√©sents",
    "items": [
      {
        "graphique": "Graphique FC (rouge)",
        "modifications": [
          "Ajouter des zones de fond color√©es selon la zone FC",
          "Z1 (84-101): #e5f7e5 (vert tr√®s p√¢le)",
          "Z2 (101-117): #c8f0c8 (vert p√¢le) üéØ ZONE CIBLE",
          "Z3 (117-134): #fff4cc (jaune p√¢le)",
          "Z4 (134-151): #ffe5cc (orange p√¢le)",
          "Z5 (151-168): #ffe0e0 (rouge p√¢le)",
          "Ajouter une annotation horizontale √† FC=120 bpm (limite Z2)",
          "Afficher le % de temps pass√© dans chaque zone sur le tooltip"
        ],
        "exemple_code": "annotations: { yaxis: [ { y: 101, y2: 117, fillColor: '#c8f0c8', label: { text: 'Zone 2 - Cible' } } ] }"
      },
      {
        "graphique": "Graphique Allure (vert fonc√©)",
        "modifications": [
          "Ajouter une ligne horizontale √† 6:00/km (allure Z2 recommand√©e)",
          "Ajouter une zone de fond verte p√¢le entre 6:00 et 6:30/km (plage Z2)",
          "Afficher en tooltip : 'Cette allure correspond √† Zone X'"
        ]
      },
      {
        "graphique": "Sparklines (k_moy et d√©rive)",
        "modifications": [
          "Ajouter une ligne de seuil horizontal (k=6.5 pour k_moy, d√©rive=1.15 pour d√©rive)",
          "Colorer les points au-dessus/en-dessous du seuil (vert/rouge)",
          "Afficher la tendance (‚Üó en am√©lioration, ‚Üí stable, ‚Üò en d√©gradation)"
        ]
      }
    ]
  },

  "calculs_backend": {
    "description": "Calculs √† ajouter dans app.py",
    "fonctions": [
      {
        "nom": "calculate_zone_distribution",
        "input": "points (liste avec 'hr')",
        "output": {
          "zone_1_pct": "float",
          "zone_2_pct": "float",
          "zone_3_pct": "float",
          "zone_4_pct": "float",
          "zone_5_pct": "float"
        },
        "formule": "Pour chaque point, d√©terminer la zone selon FC, puis % du temps total",
        "zones": {
          "zone_1": "84-101 bpm",
          "zone_2": "101-117 bpm",
          "zone_3": "117-134 bpm",
          "zone_4": "134-151 bpm",
          "zone_5": "151-168 bpm"
        }
      },
      {
        "nom": "calculate_fc_variability",
        "input": "points (liste avec 'hr')",
        "output": "float (pourcentage)",
        "formule": "((max(hr) - min(hr)) / min(hr)) * 100"
      },
      {
        "nom": "calculate_allure_in_zone2",
        "input": "points (liste avec 'hr' et 'vel')",
        "output": "float (allure moyenne en min/km)",
        "formule": "Filtrer points o√π 101 <= hr <= 117, puis calculer allure moyenne",
        "explication": "Permet de suivre la progression a√©robie"
      },
      {
        "nom": "detect_early_effort_spike",
        "input": "points (liste avec 'hr')",
        "output": "boolean (true si d√©part trop brutal)",
        "formule": "Si FC augmente > 15% dans le premier tiers de la course",
        "action": "Afficher alerte 'D√©part trop rapide d√©tect√©'"
      },
      {
        "nom": "predict_10k_time",
        "input": "k_moy, deriv_cardio, fc_z2_avg",
        "output": {
          "time_estimate": "string (mm:ss)",
          "readiness": "string (Pr√™t / Pas encore pr√™t)",
          "conditions": "string (explications)"
        },
        "formule": "Bas√© sur allure en Z2 actuelle et k_moy. Si deriv < 1.15 et k > 6.5, pr√©voir 10k en Z2-Z3"
      },
      {
        "nom": "predict_semi_readiness",
        "input": "sorties_longues_z2 (distances max en Z2), k_moy, deriv_cardio",
        "output": {
          "ready_in_months": "int",
          "current_readiness": "string (0-100%)",
          "next_milestone": "string"
        },
        "formule": "Pr√™t si : sortie longue ‚â• 18 km en Z2, k_moy > 7, deriv < 1.15 sur 15 km"
      }
    ]
  },

  "data_enrichment": {
    "description": "Donn√©es suppl√©mentaires √† stocker dans activities.json",
    "nouveaux_champs": [
      {
        "field": "zone_distribution",
        "type": "object",
        "content": {
          "zone_1_pct": "float",
          "zone_2_pct": "float",
          "zone_3_pct": "float",
          "zone_4_pct": "float",
          "zone_5_pct": "float"
        },
        "calcul": "Dans enrich_activities()"
      },
      {
        "field": "fc_variability_pct",
        "type": "float",
        "content": "Pourcentage de variation FC (ex: 31.3 pour derni√®re course)",
        "calcul": "Dans enrich_activities()"
      },
      {
        "field": "allure_in_zone2",
        "type": "float",
        "content": "Allure moyenne quand FC en Zone 2 (en min/km)",
        "calcul": "Dans enrich_activities()"
      },
      {
        "field": "early_spike_detected",
        "type": "boolean",
        "content": "true si d√©part trop brutal (FC +15% premier tiers)",
        "calcul": "Dans enrich_activities()"
      },
      {
        "field": "coaching_alert",
        "type": "string",
        "content": "Message d'alerte si seuils d√©pass√©s (ex: 'D√©rive trop √©lev√©e')",
        "calcul": "Dans enrich_activities()"
      }
    ]
  },

  "ui_recommendations": {
    "description": "Recommandations d'interface utilisateur",
    "principes": [
      "üéØ Priorit√© : Sant√© cardiaque avant performance",
      "üíö Encourager les sorties en Zone 2 (feedback positif)",
      "üî¥ Alerter clairement si d√©rive > 1.25 ou temps en Z4-5 > 40%",
      "üìä Visualiser l'√©volution sur le long terme (graphiques tendances)",
      "üí¨ Langage chaleureux et bienveillant (coach, pas juge)",
      "üì± Mobile-first : indicateurs lisibles sur petit √©cran"
    ],
    "couleurs": {
      "zone_2_vert": "#4ade80",
      "alerte_orange": "#fb923c",
      "alerte_rouge": "#ef4444",
      "info_bleu": "#60a5fa",
      "excellent_vert_fonce": "#16a34a"
    },
    "emojis": {
      "excellent": "üü¢",
      "bon": "üü°",
      "attention": "üü†",
      "alerte": "üî¥",
      "progression": "üìà",
      "objectif": "üéØ",
      "conseil": "üí°",
      "sante": "üè•"
    }
  },

  "exemple_message_alerte": {
    "condition": "deriv_cardio > 1.30",
    "html": "<div class='alert-box alert-red'>\n  <div class='alert-icon'>üî¥</div>\n  <div class='alert-content'>\n    <h3>Alerte D√©rive Cardio</h3>\n    <p>Ta derni√®re sortie montre une <strong>d√©rive de 1.33</strong> avec une FC qui augmente de <strong>+31%</strong>.</p>\n    <p>üéØ <strong>Conseil imm√©diat :</strong> Pars plus progressivement √† ta prochaine sortie (110 bpm). L'objectif est de rester en dessous de 120 bpm pendant les 2 premiers km.</p>\n    <p>üí° Rappel : √Ä 52 ans, 80% de tes sorties doivent √™tre en Zone 2 (FC < 120 bpm) pour construire une vraie endurance.</p>\n  </div>\n</div>",
    "style": "background: #fee; border-left: 4px solid #f44; padding: 1rem; border-radius: 8px; margin: 1rem 0;"
  }
}
